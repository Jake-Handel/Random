<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brain Rot Clicker - Ultimate Meme Game</title>
    
    <!-- CrazyGames SDK v3 -->
    <script src="https://sdk.crazygames.com/crazygames-sdk-v3.js"></script>
    
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="game-container">
        <header class="header">
            <h1 class="game-title">üß† Brain Rot Clicker üéÆ</h1>
            <div class="score-display">
                üß† Brain Rot Points: <span id="score">0</span>
            </div>
        </header>

        <main class="main-game">
            <section class="clicker-section">
                <div class="brain-rot-character" id="clickerCharacter">
                    <div class="character-emoji" id="currentCharacter">üß†</div>
                </div>
            </section>
        </main>

        <!-- Top Left Controls -->
        <div class="top-left-controls">
            <button class="settings-btn" onclick="openStatsModal()">
                ‚öôÔ∏è
            </button>
        </div>

        <!-- Top Right Controls -->
        <div class="top-controls">
            <button class="buy-brainrots-btn" onclick="openBrainrotsModal()">
                üõí Buy Brainrots
            </button>
            <button class="burger-menu-btn" onclick="openUpgradesModal()">
                üçî
            </button>
        </div>

        <!-- Stats Modal -->
        <div class="stats-modal" id="statsModal">
            <div class="stats-modal-content">
                <button class="close-modal-btn" onclick="closeStatsModal()">&times;</button>
                <h2 class="modal-title">üìä Game Stats</h2>
                <div class="stats-section">
                    <div class="stat-item">
                        <span class="stat-label">Total Clicks:</span>
                        <span class="stat-value" id="totalClicks">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Points per Click:</span>
                        <span class="stat-value" id="pointsPerClick">1</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Auto Points/sec:</span>
                        <span class="stat-value" id="autoPoints">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Characters Unlocked:</span>
                        <span class="stat-value" id="unlockedCharacters">1/19</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Upgrades Modal -->
        <div class="upgrades-modal" id="upgradesModal">
            <div class="upgrades-modal-content">
                <button class="close-modal-btn" onclick="closeUpgradesModal()">&times;</button>
                <h2 class="modal-title">‚ö° Upgrades Shop</h2>
                <div id="upgradesList" style="padding: 20px; min-height: 300px;">
                    <!-- Upgrade items will be inserted here by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Brainrots Modal -->
        <div class="brainrots-modal" id="brainrotsModal">
            <div class="modal-content">
                <button class="close-modal-btn" onclick="closeBrainrotsModal()">&times;</button>
                <h2 class="modal-title">üß† Brainrot Collection</h2>
                <div class="brainrots-grid" id="brainrotsGrid"></div>
            </div>
        </div>
    </div>

    <div class="achievement-popup" id="achievementPopup">
        <div class="achievement-title" id="achievementTitle"></div>
        <div class="achievement-desc" id="achievementDesc"></div>
    </div>

    <div class="save-indicator" id="saveIndicator">
        üíæ Game Saved!
    </div>

    <script>
        // Game state
        let gameState = {
            score: 0,
            totalClicks: 0,
            pointsPerClick: 1,
            autoPoints: 0,
            multiplier: 1,
            currentCharacter: 0,
            unlockedCharacters: [0],
            upgrades: {
                clickPower: { level: 0, baseCost: 10, multiplier: 1.5 },
                autoClicker: { level: 0, baseCost: 50, multiplier: 1.8 },
                brainRotMultiplier: { level: 0, baseCost: 100, multiplier: 2 },
                megaBrain: { level: 0, baseCost: 500, multiplier: 2.5 },
                viralBoost: { level: 0, baseCost: 1000, multiplier: 3 },
                memeLord: { level: 0, baseCost: 5000, multiplier: 4 },
                ultimateRot: { level: 0, baseCost: 10000, multiplier: 5 }
            },
            achievements: []
        };

        // Brain rot characters that contribute to click power
        const characters = [
            { emoji: 'üß†', name: 'Fresh Brain', unlockCost: 0, clickBonus: 0 },
            { emoji: 'üçï', name: 'Noobini Pizzanini', unlockCost: 150, clickBonus: 2 },
            { emoji: 'üåÆ', name: 'Lirili Larila', unlockCost: 300, clickBonus: 5 },
            { emoji: 'üßÄ', name: 'Tim Cheese', unlockCost: 600, clickBonus: 10 },
            { emoji: 'üå∏', name: 'FluriFlura', unlockCost: 1200, clickBonus: 20 },
            { emoji: 'ü¶î', name: 'Talpa Di Fero', unlockCost: 2500, clickBonus: 35 },
            { emoji: 'üí£', name: 'Svinina Bombardino', unlockCost: 5000, clickBonus: 50 },
            { emoji: 'ü•ù', name: 'Pipi Kiwi', unlockCost: 10000, clickBonus: 75 },
            { emoji: 'üåΩ', name: 'Pipi Corni', unlockCost: 20000, clickBonus: 100 },
            { emoji: 'üé™', name: 'Trippi Troppi', unlockCost: 40000, clickBonus: 150 },
            { emoji: 'üë¢', name: 'Gangster Footera', unlockCost: 80000, clickBonus: 200 },
            { emoji: 'üé≠', name: 'Boneca Ambalabu', unlockCost: 150000, clickBonus: 300 },
            { emoji: 'üéµ', name: 'Ta Ta Ta Ta Sahur', unlockCost: 300000, clickBonus: 400 },
            { emoji: 'üéØ', name: 'Tric Trac Baraboom', unlockCost: 600000, clickBonus: 500 },
            { emoji: '', name: 'Bandito Bobritto', unlockCost: 1000000, clickBonus: 750 },
            { emoji: 'üåµ', name: 'Cacto Hipopotamo', unlockCost: 2500000, clickBonus: 1000 },
            { emoji: '', name: 'Skibidi Toilet', unlockCost: 5000000, clickBonus: 1500 },
            { emoji: '', name: 'La Jolly Grande', unlockCost: 10000000, clickBonus: 2000 },
            { emoji: 'üêï', name: 'Cerberus', unlockCost: 25000000, clickBonus: 3000 }
        ];

        // Upgrade definitions
        const upgradeTypes = [
            { 
                id: 'clickPower', 
                name: 'Stronger Clicks', 
                desc: 'Increase points per click',
                effect: (level) => level + 1
            },
            { 
                id: 'autoClicker', 
                name: 'Auto Clicker', 
                desc: 'Automatically click every second',
                effect: (level) => level * 5
            },
            { 
                id: 'brainRotMultiplier', 
                name: 'Brain Rot Multiplier', 
                desc: 'Multiply all points earned',
                effect: (level) => 1 + (level * 0.5)
            },
            { 
                id: 'megaBrain', 
                name: 'Mega Brain', 
                desc: 'Huge point boost',
                effect: (level) => level * 20
            },
            { 
                id: 'viralBoost', 
                name: 'Viral Boost', 
                desc: 'Go viral for more points',
                effect: (level) => level * 50
            },
            { 
                id: 'memeLord', 
                name: 'Meme Lord', 
                desc: 'Become a meme master',
                effect: (level) => level * 100
            },
            { 
                id: 'ultimateRot', 
                name: 'Ultimate Brain Rot', 
                desc: 'Maximum brain rot achieved',
                effect: (level) => level * 500
            }
        ];

        // CrazyGames SDK integration
        let sdkInitialized = false;

        async function initializeSDK() {
            try {
                if (typeof window.CrazyGames !== 'undefined') {
                    await window.CrazyGames.SDK.init();
                    sdkInitialized = true;
                    console.log('CrazyGames SDK initialized');
                    
                    // Load saved game data
                    await loadGameData();
                    
                    // Start gameplay tracking
                    window.CrazyGames.SDK.game.gameplayStart();
                } else {
                    console.log('Running without CrazyGames SDK');
                    loadLocalData();
                }
            } catch (error) {
                console.error('SDK initialization failed:', error);
                loadLocalData();
            }
        }

        async function saveGameData() {
            try {
                if (sdkInitialized) {
                    await window.CrazyGames.SDK.data.set(gameState);
                } else {
                    localStorage.setItem('brainRotClickerSave', JSON.stringify(gameState));
                }
                showSaveIndicator();
            } catch (error) {
                console.error('Save failed:', error);
            }
        }

        async function loadGameData() {
            try {
                if (sdkInitialized) {
                    const savedData = await window.CrazyGames.SDK.data.get();
                    if (savedData) {
                        gameState = { ...gameState, ...savedData };
                    }
                } else {
                    const savedData = localStorage.getItem('brainRotClickerSave');
                    if (savedData) {
                        gameState = { ...gameState, ...JSON.parse(savedData) };
                    }
                }
                updateDisplay();
            } catch (error) {
                console.error('Load failed:', error);
            }
        }

        function loadLocalData() {
            const savedData = localStorage.getItem('brainRotClickerSave');
            if (savedData) {
                gameState = { ...gameState, ...JSON.parse(savedData) };
            }
            updateDisplay();
        }

        function showSaveIndicator() {
            const indicator = document.getElementById('saveIndicator');
            indicator.classList.add('show');
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 2000);
        }

        function openStatsModal() {
            const modal = document.getElementById('statsModal');
            modal.classList.add('show');
        }

        function closeStatsModal() {
            const modal = document.getElementById('statsModal');
            modal.classList.remove('show');
        }

        function openUpgradesModal() {
            const modal = document.getElementById('upgradesModal');
            modal.classList.add('show');
            updateUpgradesList();
        }

        function closeUpgradesModal() {
            const modal = document.getElementById('upgradesModal');
            modal.classList.remove('show');
        }

        function openBrainrotsModal() {
            const modal = document.getElementById('brainrotsModal');
            modal.classList.add('show');
            updateBrainrotsGrid();
        }

        function closeBrainrotsModal() {
            const modal = document.getElementById('brainrotsModal');
            modal.classList.remove('show');
        }

        // Game functions
        function handleCharacterClick(event) {
            const rect = event.currentTarget.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            
            // Calculate points earned
            const basePoints = gameState.pointsPerClick;
            const multiplierBonus = gameState.multiplier;
            const pointsEarned = Math.floor(basePoints * multiplierBonus);
            
            gameState.score += pointsEarned;
            gameState.totalClicks++;
            
            // Create click effect
            createClickEffect(x, y, pointsEarned);
            
            // Animate character
            const character = document.getElementById('currentCharacter');
            character.style.transform = 'scale(0.9)';
            setTimeout(() => {
                character.style.transform = 'scale(1)';
            }, 100);
            
            updateDisplay();
            checkAchievements();
            
            // Save game periodically
            if (gameState.totalClicks % 10 === 0) {
                saveGameData();
            }
        }
        
        function unlockCharacter(characterIndex) {
            const character = characters[characterIndex];
            
            if (gameState.score >= character.unlockCost && !gameState.unlockedCharacters.includes(characterIndex)) {
                gameState.score -= character.unlockCost;
                gameState.unlockedCharacters.push(characterIndex);
                
                updateDisplay();
                updateBrainrotsGrid();
                saveGameData();
                
                showAchievement('Character Unlocked!', `Unlocked ${character.name}!`);
            }
        }

        function selectCharacter(characterIndex) {
            if (gameState.unlockedCharacters.includes(characterIndex)) {
                gameState.currentCharacter = characterIndex;
                // Note: We keep the clicker as brain, this is just for display purposes
                updateBrainrotsGrid();
                saveGameData();
            }
        }

        function createClickEffect(x, y, points) {
            const effect = document.createElement('div');
            effect.className = 'click-effect';
            effect.textContent = `+${points}`;
            effect.style.left = x + 'px';
            effect.style.top = y + 'px';
            
            document.getElementById('clickerCharacter').appendChild(effect);
            
            setTimeout(() => {
                effect.remove();
            }, 1000);
        }

        function calculateUpgradeCost(upgradeId) {
            const upgrade = gameState.upgrades[upgradeId];
            return Math.floor(upgrade.baseCost * Math.pow(upgrade.multiplier, upgrade.level));
        }

        function calculateStats() {
            let pointsPerClick = 1;
            let autoPoints = 0;
            let multiplier = 1;
            
            // Calculate upgrade effects
            pointsPerClick += upgradeTypes.find(u => u.id === 'clickPower').effect(gameState.upgrades.clickPower.level);
            autoPoints += upgradeTypes.find(u => u.id === 'autoClicker').effect(gameState.upgrades.autoClicker.level);
            multiplier += upgradeTypes.find(u => u.id === 'brainRotMultiplier').effect(gameState.upgrades.brainRotMultiplier.level);
            pointsPerClick += upgradeTypes.find(u => u.id === 'megaBrain').effect(gameState.upgrades.megaBrain.level);
            autoPoints += upgradeTypes.find(u => u.id === 'viralBoost').effect(gameState.upgrades.viralBoost.level);
            pointsPerClick += upgradeTypes.find(u => u.id === 'memeLord').effect(gameState.upgrades.memeLord.level);
            autoPoints += upgradeTypes.find(u => u.id === 'ultimateRot').effect(gameState.upgrades.ultimateRot.level);
            
            // Add character click bonuses
            gameState.unlockedCharacters.forEach(characterIndex => {
                pointsPerClick += characters[characterIndex].clickBonus;
            });
            
            gameState.pointsPerClick = Math.floor(pointsPerClick);
            gameState.autoPoints = Math.floor(autoPoints);
            gameState.multiplier = multiplier;
        }

        function updateDisplay() {
            calculateStats();
            
            document.getElementById('score').textContent = gameState.score.toLocaleString();
            document.getElementById('multiplier').textContent = gameState.multiplier.toFixed(1);
            document.getElementById('totalClicks').textContent = gameState.totalClicks.toLocaleString();
            document.getElementById('pointsPerClick').textContent = gameState.pointsPerClick;
            document.getElementById('autoPoints').textContent = gameState.autoPoints;
            
            // Update character info
            document.getElementById('unlockedCharacters').textContent = `${gameState.unlockedCharacters.length}/${characters.length}`;
            
            updateUpgradesList();
            updateBrainrotsGrid();
        }

        function updateUpgradesList() {
            const container = document.getElementById('upgradesList');
            
            if (!container) {
                console.error('upgradesList container not found!');
                return;
            }
            
            let upgradesHTML = '';
            
            upgradeTypes.forEach((upgradeType, index) => {
                const upgrade = gameState.upgrades[upgradeType.id];
                const cost = calculateUpgradeCost(upgradeType.id);
                const canAfford = gameState.score >= cost;
                
                upgradesHTML += `
                    <div style="background: linear-gradient(135deg, #ff6b6b, #feca57); padding: 18px; margin: 12px 0; border-radius: 20px; color: white; border: 3px solid transparent; position: relative; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.2); display: block; visibility: visible; opacity: ${!canAfford ? '0.8' : '1'}; cursor: ${canAfford ? 'pointer' : 'not-allowed'};" onclick="${canAfford ? `buyUpgrade('${upgradeType.id}')` : 'return false'}">
                        <div style="font-size: 1.3rem; font-weight: bold; margin-bottom: 8px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">
                            ${upgradeType.name} (Level ${upgrade.level})
                        </div>
                        <div style="font-size: 1.1rem; opacity: 0.95; font-weight: bold;">
                            üß† Cost: ${cost.toLocaleString()}
                        </div>
                        <div style="font-size: 0.95rem; margin-top: 8px; opacity: 0.9;">
                            ${upgradeType.desc}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = upgradesHTML;
        }

        function buyUpgrade(upgradeId) {
            const upgrade = gameState.upgrades[upgradeId];
            const cost = calculateUpgradeCost(upgradeId);
            
            if (gameState.score >= cost) {
                gameState.score -= cost;
                upgrade.level++;
                
                updateDisplay();
                updateUpgradesList();
                saveGameData();
                
                // Show achievement for first upgrade purchase
                if (upgrade.level === 1) {
                    showAchievement('First Upgrade!', 'Purchased your first upgrade!');
                }
            }
        }

        function updateBrainrotsGrid() {
            const container = document.getElementById('brainrotsGrid');
            container.innerHTML = '';
            
            characters.forEach((character, index) => {
                const isOwned = gameState.unlockedCharacters.includes(index);
                const isSelected = gameState.currentCharacter === index;
                const canAfford = gameState.score >= character.unlockCost;
                
                const brainrotElement = document.createElement('div');
                brainrotElement.className = `brainrot-item ${isOwned ? 'owned' : ''} ${isSelected ? 'selected' : ''} ${!isOwned && !canAfford ? 'locked' : ''}`;
                brainrotElement.innerHTML = `
                    <div class="brainrot-emoji">${character.emoji}</div>
                    <div class="brainrot-name">${character.name}</div>
                    <div class="brainrot-bonus">+${character.clickBonus} üß†/click</div>
                    ${!isOwned ? `<div class="brainrot-cost">üß† ${character.unlockCost.toLocaleString()}</div>` : ''}
                `;
                
                if (isOwned) {
                    brainrotElement.onclick = () => selectCharacter(index);
                } else if (canAfford) {
                    brainrotElement.onclick = () => unlockCharacter(index);
                }
                
                container.appendChild(brainrotElement);
            });
        }

        function checkAchievements() {
            const achievements = [
                { score: 100, title: 'Century Club!', desc: 'Reached 100 brain rot points!' },
                { score: 1000, title: 'Brain Rot Master!', desc: 'Reached 1,000 brain rot points!' },
                { score: 10000, title: 'Brain Rot Legend!', desc: 'Reached 10,000 brain rot points!' },
                { clicks: 100, title: 'Clicking Pro!', desc: 'Made 100 clicks!' },
                { clicks: 1000, title: 'Click Master!', desc: 'Made 1,000 clicks!' },
                { characters: 4, title: 'Collector!', desc: 'Unlocked 4 characters!' },
                { characters: 8, title: 'Completionist!', desc: 'Unlocked all characters!' }
            ];
            
            achievements.forEach(achievement => {
                const alreadyAchieved = gameState.achievements.includes(achievement.title);
                
                if (!alreadyAchieved) {
                    let achieved = false;
                    
                    if (achievement.score && gameState.score >= achievement.score) {
                        achieved = true;
                    } else if (achievement.clicks && gameState.totalClicks >= achievement.clicks) {
                        achieved = true;
                    } else if (achievement.characters && gameState.unlockedCharacters.length >= achievement.characters) {
                        achieved = true;
                    }
                    
                    if (achieved) {
                        gameState.achievements.push(achievement.title);
                        showAchievement(achievement.title, achievement.desc);
                        saveGameData();
                    }
                }
            });
        }

        function showAchievement(title, description) {
            const popup = document.getElementById('achievementPopup');
            document.getElementById('achievementTitle').textContent = 'üèÜ ' + title;
            document.getElementById('achievementDesc').textContent = description;
            
            popup.classList.add('show');
            
            setTimeout(() => {
                popup.classList.remove('show');
            }, 3000);
        }

        function createFloatingEmojis() {
            const emojis = ['üß†', 'ü§™', 'ü§°', 'üëΩ', 'ü§ñ', 'ü¶Ñ', 'üê∏', 'üé≠', 'üåü', '‚ö°'];
            
            setInterval(() => {
                const emoji = document.createElement('div');
                emoji.className = 'floating-emoji';
                emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                emoji.style.left = Math.random() * window.innerWidth + 'px';
                emoji.style.animationDuration = (10 + Math.random() * 10) + 's';
                emoji.style.animationDelay = Math.random() * 5 + 's';
                
                document.body.appendChild(emoji);
                
                setTimeout(() => {
                    emoji.remove();
                }, 20000);
            }, 3000);
        }

        function startAutoPoints() {
            setInterval(() => {
                if (gameState.autoPoints > 0) {
                    gameState.score += gameState.autoPoints;
                    updateDisplay();
                    
                    // Save game periodically
                    if (gameState.score % 100 === 0) {
                        saveGameData();
                    }
                }
            }, 1000);
        }

        // Initialize game
        window.addEventListener('load', async () => {
            await initializeSDK();
            
            // Set up event listeners
            document.getElementById('clickerCharacter').addEventListener('click', handleCharacterClick);
            
            // Start game systems
            createFloatingEmojis();
            startAutoPoints();
            
            // Initial display update
            updateDisplay();
            
            // Save game when leaving
            window.addEventListener('beforeunload', saveGameData);
            
            // Handle visibility change for CrazyGames
            document.addEventListener('visibilitychange', () => {
                if (sdkInitialized) {
                    if (document.hidden) {
                        window.CrazyGames.SDK.game.gameplayStop();
                    } else {
                        window.CrazyGames.SDK.game.gameplayStart();
                    }
                }
            });
        });

        // Close modal when clicking outside
        window.onclick = function(event) {
            const brainrotsModal = document.getElementById('brainrotsModal');
            const upgradesModal = document.getElementById('upgradesModal');
            const statsModal = document.getElementById('statsModal');
            const gameModal = document.getElementById('gameModal');
            
            if (event.target === brainrotsModal) {
                closeBrainrotsModal();
            } else if (event.target === upgradesModal) {
                closeUpgradesModal();
            } else if (event.target === statsModal) {
                closeStatsModal();
            } else if (event.target === gameModal) {
                closeGame();
            }
        }

        // Close modal with Escape key
        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape') {
                closeBrainrotsModal();
                closeUpgradesModal();
                closeStatsModal();
            }
        });
    </script>
</body>
</html>